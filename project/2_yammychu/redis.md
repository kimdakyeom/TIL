# 프로젝트 REDIS
> **RE**mote **DI**ctionary **S**erver
>
> dictionary 구조 (key-value 형태)로 데이터를 저장하고 관리하는 서버
>
> 캐시와 비슷한 것이기 때문에 캐시와 비교해보겠다.

## [redis 공식 홈페이지](https://redis.io/) 에 나온 Redis의 핵심기능

```
Redis는 데이터베이스,캐시, 메시지 브로커 및 스트리밍 엔진으로 사용되는 오픈 소스(BSD 라이선스), 인메모리 데이터 구조 저장소 입니다.

Redis는 문자열 , 해시 , 목록 , 집합 , 범위 쿼리가 있는 정렬된 집합 , 비트맵 , 하이퍼로그 로그 , 지리 공간 인덱스 및 스트림 과 같은 컬렉션을 제공합니다.

Redis에는 복제 , Lua 스크립팅 , LRU 축출 , 트랜잭션 및 다양한 수준의 디스크 지속성 이 내장되어 있으며 다음을 통해 고가용성을 제공합니다.

Redis Sentinel 및 Redis 클러스터를 통한 자동 파티셔닝을 제공합니다.
```

## 캐시(Cache)
> 나중에 요청 올 결과를 미리 저장해두었다가 빠르게 서비스 해주는 것
>
> 미리 결과를 저장하고 나중에 요청이 오면 해당 요청에 대해서 DB 또는 API를 참조하지 않고 Cache에 접근하여 요청을 처리하게 된다.

- 파레토 법칙 : cache가 동작할 수 있는 철학

**80퍼센트의 결과는 20퍼센트의 원인으로 인해 발생한다.**

-> 모든 결과를 캐싱할 필요는 없으며 서비스를 할 때 많이 사용되는 20%를 캐싱한다면 전체적으로 영향을 주어 효율을 극대화 할 수 있다.

### 캐시 사용 구조
- **look aside cache**
  - cache에 접근하여 데이터가 존재하는지 판단하고 cache에 존재하지 않는다면 db, api를 호출

- **write back**
  - 만약 디스크 기반 db가 존재하고 데이터를 쓰는 동작이 일어난다면 동작을 요청할 때마다 db에 접근하게 된다. 이렇게 요청이 올때마다 db에 접근하게 되된다면 애플리케이션의 속도 저하가 나타날 수 있다. 
- write back은 데이터를 cache에 먼저 저장했다가 특정 시점마다 db에 전송하는 것이다. 이렇게 된다면 매 요청마다 db에 접근할 필요없이 특정 시점이 왔을 때만 db에 접근해 속도 저하를 반지할 수 있다.
- 하지만 처음에 cache(메모리)에 먼저 저장하기 때문에 데이터가 날아갈 위험이 있다.

## 인메모리
> 컴퓨터의 주기억장치인 RAM에 데이터를 올려서 사용하는 방법

### 장점
- RAM에 데이터를 저장하게 된다면 메모리 내부에서 처리가 되므로 데이터를 저장하고 조회할때 하드디스크를 오고 가는 과정을 거치지 않아도 된다. 
- 때문에 SSD,HDD 같은 저장공간에서 데이터를 가져오는 것보다 RAM에서 데이터를 가져오는 속도가 훨씬 빠르다.
- Redis는 이 방식을 사용하기 때문에 속도가 빠르다는 장점을 가지고 있다.
### 단점
- 용량으로 인해 데이터 유실이 발생할 수 있다.
- Redis는 인메모리방식이므로 서버의 메모리 용량을 초과하는 데이터를 redis에서 처리할 경우, 서버 자체에도 문제가 생기며, ram의 특성인 휘발성에 따라 ram에 저장되었던 레디스의 데이터들은 유실될 수 있다. 
- 때문에 메인 데이터베이스로 사용하기에는 무리가 있다.

## Redis 특징
redis는 cache와 달리 다음과 같은 특징을 가지고 있다.
- List, Set, Sorted Set, Hash 등과 같은 Collection을 지원한다.
- Race condition에 빠질 수 있는 것을 방지한다.
    - Redis는 Single Thread이기 때문에 Atomic 보장
### Redis의 트랜잭션
> redis의 트랜잭션을 사용할 경우 명령들을 queue에 모아두고 한번에 처리한다.

- RDB의 트랜잭션
  - 작업이 완전히 실행되거나 rollback 되는 원자성을 가지고 있다.
- Redis의 트랜잭션
  - rollback을 지원하지 않는다.
  - 중간에 실패하더라도 실패한 명령을 제외하고 나머지 명령들은 모두 실행된다.

## Redis의 사용처
> 인메모리의 장단점을 고려했을 때 Redis의 가장 적합한 역할은 캐시 데이터베이스 서버로 사용하는 것이다.

- 여러 서버에서 같은 데이터를 공유하고 싶을 때 사용한다.
- 주로 많이 쓰이는 곳
  - 인증 토큰 등을 저장
  - Ranking 보드로 사용
  - 유저 API Limit
  - Job Queue
  - 채팅